#!/bin/bash

# figure what port the elastic search has bound to
# NOTE: The port may not be the one expected if
# running multiple instances with --net=host.
PORT=$(lsof -b -i TCP:9200-9299 | grep java | grep 92[0-9][0-9] -o);

# run a basic check
curl --fail --max-time 1 "http://localhost:$PORT/" || exit 1;

# look for additinal health check scripts
HEALTHD="./var/health";

if [ -d "$HEALTHD" ]
then
    for f in `find "$HEALTHD" -type f -perm /a+x`
        do eval $f || exit 1
    done;
fi;
